# Preprocessing Scripts for EAI Estimation

This directory contains scripts and instructions related to the preprocessing steps. The goal of this stage is to prepare the raw input data into consistent formats suitable for the subsequent EAI estimation and validation steps.

## Overview of Preprocessing Steps

The key preprocessing tasks include:

1.  **NTL Data Consistency:** Ensuring spatial consistency between DMSP-CCNL and NPP-VIIRS datasets. This involves resampling NPP-VIIRS to 30 arc-seconds (using bilinear interpolation), unifying the geographic extent and grid dimensions, and performing outlier removal. *(Note: These steps were primarily conducted using QGIS 3.22.)*

2.  **NTL Thresholds Selection:** Determining appropriate brightness thresholds to distinguish electrified areas from background noise using a quantile-based approach combined with ground validation. This involves:
    * Calculating annual NTL statistics (mean, std dev, 5th percentile).
    * Analyzing trends in the 5th percentile NTL values over time (see Figure S9).
    * Determining operational thresholds based on average 5th percentile values within stable trend periods.
    * Validating these thresholds using road network sample points (see Figure S8 for sample distribution and Figure S10 for validation results). *(Note: The core analysis for threshold determination and validation is performed using Python scripts in this directory).*
3.  **Masking Strategy (for NPP-VIIRS):** Implementing a masking strategy to correct for potential underestimation in NPP-VIIRS data due to its later satellite overpass time compared to DMSP-CCNL. This involves creating a persistence mask from DMSP data (2012-2013) and combining it with a threshold-based mask for VIIRS. *(Note: This masking process was primarily conducted using QGIS as described in the main manuscript's Methods section).*
4.  **Population Data Preparation:** Processing the GlobPOP dataset, primarily involving aggregation from 30 arc-seconds to 0.1-degree resolution to match one of the analysis scales for NTL data. *(Note: This aggregation may be performed using QGIS 3.22).*




## Inputs

* Raw DMSP-CCNL NTL data (1992-2013) [See `/data/README.md` for source].
* Raw NPP-VIIRS Annual VNL V2 NTL data (2012-2022) [See `/data/README.md` for source].
* Raw GlobPOP population density data (1992-2022) [See `/data/README.md` for source].
* Global Roads Open Access Data Set (gROADSv1) [See `/data/README.md` for source].


## Outputs

The main outputs expected from this preprocessing stage (generated either by scripts here or manual QGIS steps) include:

* Spatially consistent NTL raster files (e.g., VIIRS resampled to 30 arc-seconds, unified extent).
* A file specifying the determined operational NTL thresholds for different sensors/periods.
* Raster mask files generated by the masking strategy for NPP-VIIRS.
* Processed population data (e.g., aggregated to 0.1-degree).

